<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header('汇总情况')"/>
</head>
<body class="gray-bg">
<div class="container-div">

    <div class="tabs-container">
        <a class="btn btn-info" onclick="$.table.importExcel()" shiro:hasPermission="system:user:import">
            <i class="fa fa-upload"></i> 消耗明细导入
        </a>
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true" onclick="initTable(1)">
                个人消耗情况汇总</a>
            </li>
            <li class=""><a data-toggle="tab" href="#tab-2" aria-expanded="false" onclick="initTable(2)">消耗完成率排名</a>
            </li>
        </ul>
        <div class="tab-content">
            <div id="tab-1" class="tab-pane active">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-12 search-collapse">
                            <form id="formId1">
                                <div class="select-list">
                                    <ul>
                                        <li>
                                            期间：<input type="text" name="quarter"/>
                                        </li>

                                        <li>
                                            <a class="btn btn-primary btn-rounded btn-sm" onclick="mySearch(1)"><i
                                                    class="fa fa-search"></i>&nbsp;搜索</a>
                                            <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i
                                                    class="fa fa-refresh"></i>&nbsp;重置</a>
                                            <a class="btn btn-primary btn-rounded btn-sm"
                                               onclick="$.table.exportExcel('formId')"><i class="fa fa-download"></i> 导出</a>
                                        </li>
                                    </ul>
                                </div>
                            </form>
                        </div>

                        <div class="col-sm-12 select-table table-striped">
                            <table id="bootstrap-table-1" data-mobile-responsive="true"></table>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-2" class="tab-pane">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-12 search-collapse">
                            <form id="formId2">
                                <div class="select-list">
                                    <ul>
                                        <li>
                                            期间：<input type="text" name="quarter"/>
                                        </li>

                                        <li>
                                            <a class="btn btn-primary btn-rounded btn-sm" onclick="mySearch(2)"><i
                                                    class="fa fa-search"></i>&nbsp;搜索</a>
                                            <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i
                                                    class="fa fa-refresh"></i>&nbsp;重置</a>
                                            <a class="btn btn-primary btn-rounded btn-sm"
                                               onclick="myExportExcel('2')"><i class="fa fa-download"></i> 导出</a>
                                        </li>
                                    </ul>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-12 select-table table-striped">
                            <table id="bootstrap-table-2" data-mobile-responsive="true"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div th:include="include :: footer"></div>
<script th:inline="javascript">
    var editFlag = [[${@permission.hasPermi('system:gather:edit')}]];
    var removeFlag = [[${@permission.hasPermi('system:gather:remove')}]];
    var prefix = ctx + "system/ywConsumeGather";

    function mySearch(id) {
        if (id == '1') {
            $.table._option.id = 'bootstrap-table-1';
        } else if (id == '2') {
            $.table._option.id = 'bootstrap-table-2';
        }
        $.table.search('formId' + id);
    }


    //
    // function myExportExcel(id){
    // 	var fromId = '';
    // 	if(id == '1'){
    // 		$.table._option.exportUrl = prefix + "/exportRankGrossMargin";
    // 		$.table._option.modalName = "毛利排名列表";
    // 	}
    // 	else if(id == '2'){
    // 		$.table._option.exportUrl = prefix + "/exportRankConsumption";
    // 		$.table._option.modalName = "业绩消耗排名";
    // 	}
    // 	else if(id == '3'){
    // 		$.table._option.exportUrl = prefix + "/export";
    // 		$.table._option.modalName = "华东、华北整体完成率";
    // 		fromId = 'formId3';
    // 	}
    // 	$.table.exportExcel(fromId);
    // }
    //
    var options1 = {
        id: "bootstrap-table-1",
        url: prefix + "/list",
        exportUrl: prefix + "/export",
        modalName: "消耗毛利汇总",
        showExport: true,
        showFooter: true,
        pagination : false,
        importUrl: prefix + "/importData",
        importTemplateUrl: prefix + "/importTemplate",
        columns: [{
            checkbox: true
        },
            {
                field: 'id',
                title: '主键',
                visible: false
            },
            {
                field: 'quarter',
                title: '期间',
                sortable: true
            },
            {
                field: 'area',
                title: '区域',
                sortable: true
            },
            {
                field: 'deptName',
                title: '部门',
                sortable: true
            },
            {
                field: 'salesManager',
                title: '销售经理',
                sortable: true
            },
            {
                field: 'media',
                title: '购买媒体',
                sortable: true
            },
            {
                field: 'quotas',
                title: '季度任务',
                sortable: true,
                footerFormatter: function (value) {
                    var sumBalance = 0;
                    for (var i in value) {
                        sumBalance += parseFloat(value[i].quotas);
                    }
                    return "总计：" + sumBalance.toFixed(2);
                }
            },
            {
                field: 'summation',
                title: '完成金额',
                sortable: true,
                footerFormatter: function (value) {
                    var sumBalance = 0;
                    for (var i in value) {
                        sumBalance += parseFloat(value[i].summation);
                    }
                    return "总计：" + sumBalance.toFixed(2);
                }
            },
            {
                field: 'xhptAmt',
                title: '平推完成金额',
                sortable: true
            },
            {
                field: 'timeSchedule',
                title: '时间进度',
                sortable: true
            },
            {
                field: 'xhwcRate',
                title: '完成率',
                sortable: true
            }]
    };


    var options2 = {
        id: "bootstrap-table-2",
        url: prefix + "/rankConsumptionlist",
        exportUrl: prefix + "/exportRankConsumption",
        modalName: "业绩消耗排名",
        showSearch: false,
        showRefresh: false,
        showToggle: false,
        showColumns: false,
        importUrl: prefix + "/importData",
        importTemplateUrl: prefix + "/importTemplate",
        columns: [
            [
                {
                    title: '业绩消耗排名列表',
                    align: 'center',
                    colspan: 6
                }
            ],
            [{
                checkbox: true
            },
                {
                    field: 'rownum',
                    title: '业绩消耗排名'
                },
                {
                    field: 'saleManager',
                    title: '销售经理'
                },
                {
                    field: 'quotas',
                    title: '业绩消耗总任务'
                },
                {
                    field: 'summation',
                    title: '业绩消耗完成'
                },
                {
                    field: 'rate',
                    title: '业绩消耗完成率'
                }]
        ]
    };

    $(function () {
        $.table.init(options1);
    });

    function initTable(id) {
        if (id == 1) {
            $.table.init(options1);
        } else if (id == 2) {
            $.table.init(options2);
        }
    }

</script>
</body>
<form id="importForm" enctype="multipart/form-data" class="mt20 mb10" style="display: none;">
    <div class="col-xs-offset-1">
        <input type="file" id="file" name="file"/>
        <div class="mt10 pt5">
            <input type="checkbox" id="updateSupport" name="updateSupport" title="如果登录账户已经存在，更新这条数据。"> 是否更新已经存在的用户数据
            &nbsp;	<a onclick="$.table.importTemplate()" class="btn btn-default btn-xs"><i class="fa fa-file-excel-o"></i> 下载模板</a>
        </div>
        <font color="red" class="pull-left mt10">
            提示：仅允许导入“xls”或“xlsx”格式文件！
        </font>
    </div>
</form>
</html>